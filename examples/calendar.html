<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIç¼–ç¨‹è®­ç»ƒè¥è¯¾ç¨‹æ—¥å†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .controls {
            background: #f8f9fa;
            padding: 25px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group label {
            font-weight: 600;
            color: #495057;
            font-size: 1.1em;
        }

        .control-group input, .control-group select {
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .control-group input:focus, .control-group select:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn.danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        }

        .btn.danger:hover {
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
        }

        .legend {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 20px;
            margin: 0 30px;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .legend-color.course {
            background: linear-gradient(135deg, #10ac84 0%, #1dd1a1 100%);
            color: white;
        }

        .legend-color.user {
            background: linear-gradient(135deg, #a55eea 0%, #8e44ad 100%);
            color: white;
        }

        .legend-color.today {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
        }

        .legend-color.selected {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .course-schedule {
            background: #e8f5e8;
            border: 1px solid #c3e6c3;
            padding: 20px;
            margin: 20px 30px;
            border-radius: 10px;
        }

        .course-schedule h3 {
            color: #2d5a2d;
            margin-bottom: 15px;
            text-align: center;
        }

        .course-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 10px;
        }

        .course-item {
            background: rgba(255, 255, 255, 0.7);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9em;
            display: flex;
            justify-content: space-between;
        }

        .calendar-container {
            padding: 30px;
            min-height: 400px;
        }

        .calendar-grid {
            display: grid;
            gap: 30px;
            justify-content: center;
        }

        .calendar-grid.cols-1 { grid-template-columns: 1fr; }
        .calendar-grid.cols-2 { grid-template-columns: repeat(2, 1fr); }
        .calendar-grid.cols-3 { grid-template-columns: repeat(3, 1fr); }
        .calendar-grid.cols-4 { grid-template-columns: repeat(4, 1fr); }
        .calendar-grid.cols-6 { grid-template-columns: repeat(3, 1fr); }
        .calendar-grid.cols-12 { grid-template-columns: repeat(4, 1fr); }

        @media (max-width: 1200px) {
            .calendar-grid.cols-4, .calendar-grid.cols-6, .calendar-grid.cols-12 {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 900px) {
            .calendar-grid {
                grid-template-columns: repeat(2, 1fr) !important;
            }
        }

        @media (max-width: 600px) {
            .calendar-grid {
                grid-template-columns: 1fr !important;
            }
        }

        .month-calendar {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: all 0.3s ease;
            animation: fadeInUp 0.6s ease forwards;
            opacity: 0;
            transform: translateY(30px);
        }

        .month-calendar:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .month-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 1.3em;
            font-weight: 700;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .weekday {
            padding: 15px 5px;
            text-align: center;
            font-weight: 600;
            color: #495057;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #f1f3f4;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            position: relative;
        }

        .day:hover {
            background: #e3f2fd;
            color: #1976d2;
            transform: scale(1.05);
        }

        .day.other-month {
            color: #adb5bd;
            background: #f8f9fa;
        }

        .day.today {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }

        .day.selected {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            font-weight: 700;
        }

        .day.course-date {
            background: linear-gradient(135deg, #10ac84 0%, #1dd1a1 100%);
            color: white;
            font-weight: 700;
            position: relative;
        }

        .day.course-date::after {
            content: 'ğŸ“š';
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 10px;
        }

        .day.user-marked {
            background: linear-gradient(135deg, #a55eea 0%, #8e44ad 100%);
            color: white;
            font-weight: 700;
            position: relative;
        }

        .day.user-marked::after {
            content: 'ğŸ“Œ';
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 10px;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #6c757d;
            font-size: 1.2em;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-info {
            background: #e8f5e8;
            border: 1px solid #c3e6c3;
            color: #2d5a2d;
            padding: 15px;
            margin: 20px 30px;
            border-radius: 8px;
            font-weight: 500;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ—“ï¸ AIç¼–ç¨‹è®­ç»ƒè¥è¯¾ç¨‹æ—¥å†</h1>
            <p>ç‚¹å‡»æ—¥æœŸè¿›è¡Œæ ‡è®°ï¼Œç»¿è‰²ä¸ºè¯¾ç¨‹æ—¥æœŸï¼Œç´«è‰²ä¸ºç”¨æˆ·æ ‡è®°</p>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label for="monthCount">æ˜¾ç¤ºæœˆä»½æ•°:</label>
                <select id="monthCount">
                    <option value="1">1ä¸ªæœˆ</option>
                    <option value="2">2ä¸ªæœˆ</option>
                    <option value="3" selected>3ä¸ªæœˆ</option>
                    <option value="4">4ä¸ªæœˆ</option>
                    <option value="6">6ä¸ªæœˆ</option>
                    <option value="12">12ä¸ªæœˆ</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="startYear">èµ·å§‹å¹´ä»½:</label>
                <input type="number" id="startYear" min="2020" max="2030" value="2024">
            </div>
            
            <div class="control-group">
                <label for="startMonth">èµ·å§‹æœˆä»½:</label>
                <select id="startMonth">
                    <option value="0">1æœˆ</option>
                    <option value="1">2æœˆ</option>
                    <option value="2">3æœˆ</option>
                    <option value="3">4æœˆ</option>
                    <option value="4">5æœˆ</option>
                    <option value="5">6æœˆ</option>
                    <option value="6">7æœˆ</option>
                    <option value="7">8æœˆ</option>
                    <option value="8" selected>9æœˆ</option>
                    <option value="9">10æœˆ</option>
                    <option value="10">11æœˆ</option>
                    <option value="11">12æœˆ</option>
                </select>
            </div>
            
            <button class="btn" onclick="updateCalendar()">ğŸ”„ æ›´æ–°æ—¥å†</button>
            <button class="btn danger" onclick="clearAllMarks()">ğŸ§¹ æ¸…é™¤æ ‡è®°</button>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color course">ğŸ“š</div>
                <span>è¯¾ç¨‹æ—¥æœŸ</span>
            </div>
            <div class="legend-item">
                <div class="legend-color user">ğŸ“Œ</div>
                <span>ç”¨æˆ·æ ‡è®°</span>
            </div>
            <div class="legend-item">
                <div class="legend-color today">ğŸ“…</div>
                <span>ä»Šå¤©</span>
            </div>
            <div class="legend-item">
                <div class="legend-color selected">âœ¨</div>
                <span>é€‰ä¸­æ—¥æœŸ</span>
            </div>
        </div>
        
        <div class="course-schedule">
            <h3>ğŸ“š AIç¼–ç¨‹è®­ç»ƒè¥è¯¾ç¨‹å®‰æ’ (å…±10èŠ‚è¯¾)</h3>
            <div class="course-list">
                <div class="course-item"><span>ç¬¬1è¯¾: 9æœˆ17æ—¥</span><span>20:00-21:30</span></div>
                <div class="course-item"><span>ç¬¬2è¯¾: 9æœˆ20æ—¥</span><span>20:00-21:30</span></div>
                <div class="course-item"><span>ç¬¬3è¯¾: 9æœˆ24æ—¥</span><span>20:00-21:30</span></div>
                <div class="course-item"><span>ç¬¬4è¯¾: 9æœˆ27æ—¥</span><span>20:00-21:30</span></div>
                <div class="course-item"><span>ç¬¬5è¯¾: 10æœˆ1æ—¥</span><span>20:00-21:30</span></div>
                <div class="course-item"><span>ç¬¬6è¯¾: 10æœˆ4æ—¥</span><span>20:00-21:30</span></div>
                <div class="course-item"><span>ç¬¬7è¯¾: 10æœˆ8æ—¥</span><span>20:00-21:30</span></div>
                <div class="course-item"><span>ç¬¬8è¯¾: 10æœˆ11æ—¥</span><span>20:00-21:30</span></div>
                <div class="course-item"><span>ç¬¬9è¯¾: 10æœˆ15æ—¥</span><span>20:00-21:30</span></div>
                <div class="course-item"><span>ç¬¬10è¯¾: 10æœˆ18æ—¥</span><span>20:00-21:30</span></div>
            </div>
        </div>
        
        <div class="status-info" id="statusInfo">
            å½“å‰æ˜¾ç¤º: 3ä¸ªæœˆ | æ¯æ¬¡ä¿®æ”¹æœˆä»½æ•°æ—¶ï¼Œæ—§è§†å›¾å°†è¢«å®Œå…¨é”€æ¯å¹¶é‡æ–°åˆ›å»º
        </div>
        
        <div class="calendar-container">
            <div id="calendarGrid" class="calendar-grid cols-3">
                <div class="loading">æ­£åœ¨åŠ è½½æ—¥å†...</div>
            </div>
        </div>
    </div>

    <script>
        // è¯¾ç¨‹æ—¥æœŸæ•°ç»„ (æœˆä»½ä»0å¼€å§‹ï¼Œæ‰€ä»¥9æœˆæ˜¯8ï¼Œ10æœˆæ˜¯9)
        const courseDates = [
            { year: 2024, month: 8, day: 17, lesson: 'ç¬¬1è¯¾' },
            { year: 2024, month: 8, day: 20, lesson: 'ç¬¬2è¯¾' },
            { year: 2024, month: 8, day: 24, lesson: 'ç¬¬3è¯¾' },
            { year: 2024, month: 8, day: 27, lesson: 'ç¬¬4è¯¾' },
            { year: 2024, month: 9, day: 1, lesson: 'ç¬¬5è¯¾' },
            { year: 2024, month: 9, day: 4, lesson: 'ç¬¬6è¯¾' },
            { year: 2024, month: 9, day: 8, lesson: 'ç¬¬7è¯¾' },
            { year: 2024, month: 9, day: 11, lesson: 'ç¬¬8è¯¾' },
            { year: 2024, month: 9, day: 15, lesson: 'ç¬¬9è¯¾' },
            { year: 2024, month: 9, day: 18, lesson: 'ç¬¬10è¯¾' }
        ];

        // ç”¨æˆ·æ ‡è®°ç®¡ç†ç±»
        class DateMarker {
            constructor() {
                this.markedDates = this.loadMarkedDates();
            }

            loadMarkedDates() {
                try {
                    const saved = localStorage.getItem('userMarkedDates');
                    return saved ? JSON.parse(saved) : [];
                } catch (e) {
                    console.error('åŠ è½½æ ‡è®°æ—¥æœŸå¤±è´¥:', e);
                    return [];
                }
            }

            saveMarkedDates() {
                try {
                    localStorage.setItem('userMarkedDates', JSON.stringify(this.markedDates));
                    console.log('æ ‡è®°æ—¥æœŸå·²ä¿å­˜:', this.markedDates.length + 'ä¸ª');
                } catch (e) {
                    console.error('ä¿å­˜æ ‡è®°æ—¥æœŸå¤±è´¥:', e);
                }
            }

            isMarked(year, month, day) {
                return this.markedDates.some(date => 
                    date.year === year && date.month === month && date.day === day
                );
            }

            toggleMark(year, month, day) {
                const index = this.markedDates.findIndex(date => 
                    date.year === year && date.month === month && date.day === day
                );

                if (index >= 0) {
                    this.markedDates.splice(index, 1);
                    console.log('å–æ¶ˆæ ‡è®°:', year + '-' + (month + 1) + '-' + day);
                    return false;
                } else {
                    this.markedDates.push({ year, month, day });
                    console.log('æ·»åŠ æ ‡è®°:', year + '-' + (month + 1) + '-' + day);
                    return true;
                }
            }

            clearAllMarks() {
                this.markedDates = [];
                this.saveMarkedDates();
                console.log('æ‰€æœ‰æ ‡è®°å·²æ¸…é™¤');
            }

            getMarkedDates() {
                return this.markedDates;
            }
        }

        // å…¨å±€å˜é‡
        let currentCalendarInstance = null;
        const dateMarker = new DateMarker();
        
        // æœˆä»½åç§°
        const monthNames = [
            'ä¸€æœˆ', 'äºŒæœˆ', 'ä¸‰æœˆ', 'å››æœˆ', 'äº”æœˆ', 'å…­æœˆ',
            'ä¸ƒæœˆ', 'å…«æœˆ', 'ä¹æœˆ', 'åæœˆ', 'åä¸€æœˆ', 'åäºŒæœˆ'
        ];
        
        // æ˜ŸæœŸåç§°
        const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];

        // å¢å¼ºçš„æ—¥å†å®ä¾‹ç±»
        class EnhancedCalendarInstance {
            constructor(monthCount, startYear, startMonth) {
                this.monthCount = monthCount;
                this.startYear = startYear;
                this.startMonth = startMonth;
                this.data = [];
                this.isDestroyed = false;
                
                console.log('ğŸ“… åˆ›å»ºæ–°çš„å¢å¼ºæ—¥å†å®ä¾‹: ' + monthCount + 'ä¸ªæœˆ, èµ·å§‹: ' + startYear + 'å¹´' + (startMonth + 1) + 'æœˆ');
                this.generateCalendarData();
            }
            
            generateCalendarData() {
                this.data = [];
                const today = new Date();
                
                for (let i = 0; i < this.monthCount; i++) {
                    const currentDate = new Date(this.startYear, this.startMonth + i, 1);
                    const year = currentDate.getFullYear();
                    const month = currentDate.getMonth();
                    
                    const firstDay = new Date(year, month, 1).getDay();
                    const daysInMonth = new Date(year, month + 1, 0).getDate();
                    const prevMonthDays = new Date(year, month, 0).getDate();
                    
                    const monthData = {
                        year,
                        month,
                        monthName: year + 'å¹´ ' + monthNames[month],
                        days: []
                    };
                    
                    // æ·»åŠ ä¸Šä¸ªæœˆçš„æ—¥æœŸ
                    for (let j = firstDay - 1; j >= 0; j--) {
                        monthData.days.push({
                            day: prevMonthDays - j,
                            year: month === 0 ? year - 1 : year,
                            month: month === 0 ? 11 : month - 1,
                            isCurrentMonth: false,
                            isToday: false,
                            isCourseDate: false,
                            isUserMarked: false
                        });
                    }
                    
                    // æ·»åŠ å½“æœˆçš„æ—¥æœŸ
                    for (let day = 1; day <= daysInMonth; day++) {
                        const isToday = today.getFullYear() === year && 
                                       today.getMonth() === month && 
                                       today.getDate() === day;
                        
                        // æ£€æŸ¥æ˜¯å¦æ˜¯è¯¾ç¨‹æ—¥æœŸ
                        const courseInfo = courseDates.find(course => 
                            course.year === year && course.month === month && course.day === day
                        );
                        
                        // æ£€æŸ¥æ˜¯å¦æ˜¯ç”¨æˆ·æ ‡è®°æ—¥æœŸ
                        const isUserMarked = dateMarker.isMarked(year, month, day);
                        
                        monthData.days.push({
                            day,
                            year,
                            month,
                            isCurrentMonth: true,
                            isToday,
                            isCourseDate: !!courseInfo,
                            courseInfo: courseInfo || null,
                            isUserMarked
                        });
                    }
                    
                    // æ·»åŠ ä¸‹ä¸ªæœˆçš„æ—¥æœŸ
                    const remainingDays = 42 - monthData.days.length;
                    for (let day = 1; day <= remainingDays; day++) {
                        monthData.days.push({
                            day,
                            year: month === 11 ? year + 1 : year,
                            month: month === 11 ? 0 : month + 1,
                            isCurrentMonth: false,
                            isToday: false,
                            isCourseDate: false,
                            isUserMarked: false
                        });
                    }
                    
                    this.data.push(monthData);
                }
                
                console.log('âœ… å¢å¼ºæ—¥å†æ•°æ®ç”Ÿæˆå®Œæˆ: ' + this.data.length + 'ä¸ªæœˆä»½');
            }
            
            render() {
                if (this.isDestroyed) {
                    console.warn('âš ï¸ å°è¯•æ¸²æŸ“å·²é”€æ¯çš„æ—¥å†å®ä¾‹');
                    return;
                }
                
                const container = document.getElementById('calendarGrid');
                container.className = 'calendar-grid cols-' + this.monthCount;
                container.innerHTML = '';
                
                this.data.forEach((monthData, index) => {
                    const monthElement = this.createMonthElement(monthData, index);
                    container.appendChild(monthElement);
                });
                
                console.log('ğŸ¨ å¢å¼ºæ—¥å†æ¸²æŸ“å®Œæˆ: ' + this.data.length + 'ä¸ªæœˆä»½');
            }
            
            createMonthElement(monthData, index) {
                const monthDiv = document.createElement('div');
                monthDiv.className = 'month-calendar';
                monthDiv.style.animationDelay = (index * 0.1) + 's';
                
                const header = document.createElement('div');
                header.className = 'month-header';
                header.textContent = monthData.monthName;
                monthDiv.appendChild(header);
                
                const weekdaysDiv = document.createElement('div');
                weekdaysDiv.className = 'weekdays';
                weekdays.forEach(function(day) {
                    const dayDiv = document.createElement('div');
                    dayDiv.className = 'weekday';
                    dayDiv.textContent = day;
                    weekdaysDiv.appendChild(dayDiv);
                });
                monthDiv.appendChild(weekdaysDiv);
                
                const daysDiv = document.createElement('div');
                daysDiv.className = 'days';
                
                monthData.days.forEach(function(dayData) {
                    const dayDiv = document.createElement('div');
                    dayDiv.className = 'day';
                    dayDiv.textContent = dayData.day;
                    
                    if (!dayData.isCurrentMonth) {
                        dayDiv.classList.add('other-month');
                    }
                    
                    if (dayData.isToday) {
                        dayDiv.classList.add('today');
                    }
                    
                    if (dayData.isCourseDate) {
                        dayDiv.classList.add('course-date');
                        dayDiv.setAttribute('data-lesson', dayData.courseInfo.lesson);
                        dayDiv.title = dayData.courseInfo.lesson + ' - ' + (dayData.month + 1) + 'æœˆ' + dayData.day + 'æ—¥ 20:00-21:30';
                    } else if (dayData.isUserMarked) {
                        dayDiv.classList.add('user-marked');
                        dayDiv.title = 'ç”¨æˆ·æ ‡è®°æ—¥æœŸ - ç‚¹å‡»å–æ¶ˆæ ‡è®°';
                    } else if (dayData.isCurrentMonth) {
                        dayDiv.title = 'ç‚¹å‡»æ ‡è®°æ­¤æ—¥æœŸ';
                    }
                    
                    dayDiv.addEventListener('click', function() {
                        document.querySelectorAll('.day.selected').forEach(function(el) {
                            el.classList.remove('selected');
                        });
                        
                        if (dayData.isCurrentMonth) {
                            dayDiv.classList.add('selected');
                            
                            if (dayData.isCourseDate) {
                                console.log('ğŸ“š é€‰ä¸­è¯¾ç¨‹æ—¥æœŸ: ' + dayData.courseInfo.lesson);
                                const statusInfo = document.getElementById('statusInfo');
                                statusInfo.textContent = 'å·²é€‰ä¸­è¯¾ç¨‹: ' + dayData.courseInfo.lesson + ' - ' + (dayData.month + 1) + 'æœˆ' + dayData.day + 'æ—¥ 20:00-21:30';
                                statusInfo.style.background = '#fef3c7';
                                statusInfo.style.borderColor = '#fbbf24';
                                statusInfo.style.color = '#92400e';
                            } else {
                                const wasMarked = dateMarker.toggleMark(dayData.year, dayData.month, dayData.day);
                                dateMarker.saveMarkedDates();
                                
                                if (wasMarked) {
                                    dayDiv.classList.add('user-marked');
                                    dayDiv.title = 'ç”¨æˆ·æ ‡è®°æ—¥æœŸ - ç‚¹å‡»å–æ¶ˆæ ‡è®°';
                                    dayData.isUserMarked = true;
                                } else {
                                    dayDiv.classList.remove('user-marked');
                                    dayDiv.title = 'ç‚¹å‡»æ ‡è®°æ­¤æ—¥æœŸ';
                                    dayData.isUserMarked = false;
                                }
                                
                                updateStatusInfo();
                            }
                        }
                    });
                    
                    daysDiv.appendChild(dayDiv);
                });
                
                monthDiv.appendChild(daysDiv);
                return monthDiv;
            }
            
            destroy() {
                if (this.isDestroyed) {
                    return;
                }
                
                console.log('ğŸ—‘ï¸ é”€æ¯å¢å¼ºæ—¥å†å®ä¾‹: ' + this.monthCount + 'ä¸ªæœˆ');
                this.data = [];
                
                const container = document.getElementById('calendarGrid');
                if (container) {
                    container.innerHTML = '<div class="loading">æ­£åœ¨é”€æ¯æ—§è§†å›¾...</div>';
                }
                
                this.isDestroyed = true;
                console.log('âœ… å¢å¼ºæ—¥å†å®ä¾‹å·²å®Œå…¨é”€æ¯');
            }
        }

        // æ›´æ–°çŠ¶æ€ä¿¡æ¯
        function updateStatusInfo() {
            const statusInfo = document.getElementById('statusInfo');
            const markedCount = dateMarker.getMarkedDates().length;
            const monthCount = parseInt(document.getElementById('monthCount').value);
            const startYear = parseInt(document.getElementById('startYear').value);
            const startMonth = parseInt(document.getElementById('startMonth').value);
            
            statusInfo.textContent = 'å½“å‰æ˜¾ç¤º: ' + monthCount + 'ä¸ªæœˆ | èµ·å§‹: ' + startYear + 'å¹´' + (startMonth + 1) + 'æœˆ | è¯¾ç¨‹æ—¥æœŸ: 10ä¸ª | ç”¨æˆ·æ ‡è®°: ' + markedCount + 'ä¸ª';
            statusInfo.style.background = '#e8f5e8';
            statusInfo.style.borderColor = '#c3e6c3';
            statusInfo.style.color = '#2d5a2d';
        }

        // å…¨å±€æ›´æ–°æ—¥å†å‡½æ•°
        function updateCalendar() {
            const monthCount = parseInt(document.getElementById('monthCount').value);
            const startYear = parseInt(document.getElementById('startYear').value);
            const startMonth = parseInt(document.getElementById('startMonth').value);
            
            console.log('ğŸ”„ å¼€å§‹æ›´æ–°å¢å¼ºæ—¥å†...');
            
            if (currentCalendarInstance) {
                currentCalendarInstance.destroy();
                currentCalendarInstance = null;
            }
            
            const container = document.getElementById('calendarGrid');
            container.innerHTML = '<div class="loading">æ­£åœ¨åˆ›å»ºæ–°çš„å¢å¼ºæ—¥å†è§†å›¾...</div>';
            
            const statusInfo = document.getElementById('statusInfo');
            const markedCount = dateMarker.getMarkedDates().length;
            statusInfo.textContent = 'æ­£åœ¨åˆ›å»º: ' + monthCount + 'ä¸ªæœˆ | æ—§è§†å›¾å·²å®Œå…¨é”€æ¯ï¼Œæ–°è§†å›¾æ­£åœ¨ç”Ÿæˆ... | å·²æ ‡è®° ' + markedCount + ' ä¸ªæ—¥æœŸ';
            statusInfo.style.background = '#e8f5e8';
            statusInfo.style.borderColor = '#c3e6c3';
            statusInfo.style.color = '#2d5a2d';
            
            setTimeout(function() {
                currentCalendarInstance = new EnhancedCalendarInstance(monthCount, startYear, startMonth);
                currentCalendarInstance.render();
                updateStatusInfo();
                console.log('âœ… å¢å¼ºæ—¥å†æ›´æ–°å®Œæˆ');
            }, 500);
        }

        // æ¸…é™¤æ‰€æœ‰æ ‡è®°å‡½æ•°
        function clearAllMarks() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ ‡è®°çš„æ—¥æœŸå—ï¼Ÿ')) {
                dateMarker.clearAllMarks();
                updateCalendar();
            }
        }

        // äº‹ä»¶ç›‘å¬å™¨
        document.getElementById('monthCount').addEventListener('change', function() {
            console.log('ğŸ“Š æœˆä»½æ•°å·²æ›´æ”¹ä¸º: ' + this.value);
            updateCalendar();
        });

        document.getElementById('startYear').addEventListener('change', updateCalendar);
        document.getElementById('startMonth').addEventListener('change', updateCalendar);

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case '1':
                        document.getElementById('monthCount').value = '1';
                        updateCalendar();
                        e.preventDefault();
                        break;
                    case '2':
                        document.getElementById('monthCount').value = '2';
                        updateCalendar();
                        e.preventDefault();
                        break;
                    case '3':
                        document.getElementById('monthCount').value = '3';
                        updateCalendar();
                        e.preventDefault();
                        break;
                }
            }
        });

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ AIç¼–ç¨‹è®­ç»ƒè¥è¯¾ç¨‹æ—¥å†ç³»ç»ŸåŠ è½½å®Œæˆï¼');
            updateCalendar();
        });

        console.log('ğŸ“Œ åŠŸèƒ½è¯´æ˜:');
        console.log('  âœ… ç‚¹å‡»ä»»æ„æ—¥æœŸè¿›è¡Œæ ‡è®°/å–æ¶ˆæ ‡è®°');
        console.log('  âœ… ç´«è‰²èƒŒæ™¯ + ğŸ“Œå›¾æ ‡ = ç”¨æˆ·æ ‡è®°æ—¥æœŸ');
        console.log('  âœ… ç»¿è‰²èƒŒæ™¯ + ğŸ“šå›¾æ ‡ = è¯¾ç¨‹æ—¥æœŸ');
        console.log('  âœ… æ ‡è®°æ•°æ®è‡ªåŠ¨ä¿å­˜åˆ°localStorage');
        console.log('  âœ… æ”¯æŒæ¸…é™¤æ‰€æœ‰æ ‡è®°åŠŸèƒ½');
        console.log('  âœ… å®Œå…¨é”€æ¯é‡å»ºæœºåˆ¶');
        console.log('  âœ… é”®ç›˜å¿«æ·é”®: Ctrl+1/2/3 å¿«é€Ÿåˆ‡æ¢æœˆä»½æ•°');
    </script>
</body>
</html>
